/*! Joconut - v0.1.1 - 2012-06-04
* https://github.com/vdemedes/joconut
* Copyright (c) 2012 Vadim Demedes; Licensed MIT */
var fn;window._History=function(){function a(){}return a.listeners={},a.states={},a.loaded=!1,a.init=function(){var a=this;return window.history.replaceState?(window.history.replaceState({url:location.pathname},document.title,location.pathname),this.states[location.pathname]={state:{url:location.pathname},title:document.title},window.onpopstate=function(){return a.loaded?a.emit("change",a.states[location.pathname]):a.loaded=!0}):(this.states[location.hash]={state:{url:location.pathname},title:document.title},window.onhashchange=function(){return a.emit("change",a.states[location.hash])})},a.emit=function(a,b){var c,d,e,f,g;f=this.listeners[a],g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c(b));return g},a.on=function(a,b){return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},a.push=function(a,b,c){return b&&(document.title=b),this.states[history.pushState?c:"#"+c]={state:a,title:b},history.pushState?history.pushState(a,b,c):location.hash=c},a}(),_History.init(),fn=function(a){var b,c,d,e,f,g,h;return e=new RegExp("^("+location.protocol+"//"+location.host+"|\\.|\\/|[A-Z0-9_])","i"),a.expr[":"].local=function(a){var b,c;return a.attributes.href?(c=!1,b=a.attributes.href.value,e.test(b)&&(c=!0),c):!1},c=function(c,d){var e,f,i,j,k;f=/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(c);if(!f||!f[1])return b("error");a("body").html(f[1]),document.title=/<title>((.|\n\r])*)<\/title>/im.exec(c)[1],e=void 0;for(;;){k=/<script\b[^>]*><\/script>/gm.exec(c);if(!k)break;j=/src\=.?([A-Za-z0-9-_.\/]+).?/.exec(k[0]);if(!j)break;j=j[1],-1===g.indexOf(j)&&(g.push(j),e||(e=a("head")),e.append(k[0])),c=c.replace(k[0],"")}for(;;){k=/<link\b[^>]*\/?>/gm.exec(c);if(!k)break;if(/rel\=.?stylesheet.?/.test(k[0])){i=/href\=.?([A-Za-z0-9-_.\/]+).?/.exec(k[0]);if(!i)break;i=i[1],-1===h.indexOf(i)&&(h.push(i),e||(e=a("head")),e.append(k[0]))}c=c.replace(k[0],"")}return a("html, body").animate({scrollTop:0},"fast"),setTimeout(function(){a.joconut();if(d)return d()},50)},d=function(d,e){return b("beforeNew"),a.ajax({url:d.url,type:"GET",data:d.data,timeout:5e3,error:function(a,c){return e&&e(c),b("error")},success:function(a){return c(a,function(){return d.history&&_History.push({url:d.url},!1,d.url),e&&e(!1,a),b("new"),b("afterNew")})}})},_History.on("change",function(a){return d({url:a.state.url,history:!1}),b("new")}),g=[],a("script").each(function(){return g.push(a(this).attr("src"))}),h=[],a("link").each(function(){return h.push(a(this).attr("href"))}),a.joconut=function(){return a("a:local").each(function(){var b;return b=a(this),b.live("click",function(a){var c;return a.preventDefault(),c=b.attr("href"),d({url:c,history:!0})})})},f={},b=function(a){var b,c,d,e,g;if(!f[a])return;e=f[a],g=[];for(c=0,d=e.length;c<d;c++)b=e[c],g.push(b());return g},a.joconut.on=function(a,b){return f[a]||(f[a]=[]),f[a].push(b)},a(function(){return a.joconut()})},fn(jQuery);